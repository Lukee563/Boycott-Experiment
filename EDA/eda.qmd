---
title: "Exploratory Data Analysis"
format: md
editor: visual
---

## Research Questions:

-   Are individuals willing to buy from a more expensive seller if the seller is considered ethical compared to an unethical seller offering the same good at a cheaper price.

-   Do individuals respond to the injuctive norm (a social standard that dictates what people believe others approve of or expect them to do).

## Analysis Objective:

-   Using data collected from an experimental pilot session hosted by LEEPS \@ UC Santa Cruz on June 4th, 2025, we hope to identify early conclusions to our proposed research questions. Our sample size of 24 and the preliminary nature of this experiment prevent us from establishing causal claims, however, early conclusions to these research questions may guide later iterations of the Consumer Boycott experiment.

## Consumer Boycott - Experiment Data

Read in the experimental data.

```{r}
block1 <- read.csv("data/block1_effort_wage_2025-06-04.csv") # Effort Wage Game
block2 <- read.csv("data/block2_market_2025-06-04.csv") # Market Game
```

```{r}
library(dplyr)
library(ggplot2)

# Step 1: Count how many choose "B" in each treatment group
b_counts <- block2 %>%
  filter(player.buyer_choice == "B") %>%
  group_by(subsession.treatment) %>%
  summarise(num_B_voters = n())


ggplot(b_counts, aes(x = subsession.treatment, y = num_B_voters)) +
  geom_col(fill = "deeppink3", width = 0.5) +
  labs(
    title = "Number of B Choices per Treatment Group",
    x = "Treatment Group",
    y = "Number of B Choices"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 16),
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    panel.grid.major.y = element_line(color = "gray80"),
    panel.grid.minor = element_blank(),
    axis.text = element_text(color = "black")
  ) +
  geom_text(aes(label = num_B_voters), vjust = -0.5, size = 5)
```

```{r}
# Break the experiment up into 3 distinct phases

block2$choose_B <- ifelse(block2$player.buyer_choice == "B", 1, 0)

phase1 <- block2 %>%
  filter(index(block2) <= 24)

phase2 <- block2 %>%
  filter(index(block2) >= 25,
         index(block2) <= 48,)

phase3 <- block2 %>%
  filter(index(block2) >= 49,
         index(block2) <= 72,)
```

```{r}
# Phase 1 (pre treatment) outcome variable 
library(patchwork)

p1 <- ggplot(data = phase1, aes(x = factor(choose_B))) +
  geom_bar(fill = "deeppink3", width = 0.4) +
  geom_text(
    stat = "count",
    aes(label = after_stat(count)),
    vjust = -0.3,
    size = 4
  ) +
  scale_x_discrete(labels = c("0" = "Chose A", "1" = "Chose B")) +
  labs(
    x = "Choice",
    y = "Count",
    title = "Phase 1 Outcome"
  ) +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold"))+
  scale_y_continuous(limits = c(0, 24))

p2 <- ggplot(data = phase3, aes(x = factor(choose_B))) +
  geom_bar(fill = "deeppink3", width = 0.4) +
  geom_text(
    stat = "count",
    aes(label = after_stat(count)),
    vjust = -0.3,
    size = 4
  ) +
  scale_x_discrete(labels = c("0" = "Chose A", "1" = "Chose B")) +
  labs(
    x = "Choice",
    y = "Count",
    title = "Phase 2 Outcome"
  ) +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold"))+
  scale_y_continuous(limits = c(0, 24))

p3 <- ggplot(data = phase2, aes(x = factor(choose_B))) +
  geom_bar(fill = "deeppink3", width = 0.4) +
  geom_text(
    stat = "count",
    aes(label = after_stat(count)),
    vjust = -0.3,
    size = 4
  ) +
  scale_x_discrete(labels = c("0" = "Chose A", "1" = "Chose B"))+
  labs(
    x = "Choice",
    y = "Count",
    title = "Phase 3 Outcome"
  ) +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(face = "bold"))+
  scale_y_continuous(limits = c(0, 24))


p1 + p2 + p3
```

\

\

![]()

```{r}
library(dplyr)
# Phase dependent "Choose B" rates:

phases <- list(phase1, phase2, phase3) #data frame of each phase
results <- c()
counter <- 1

for (i in phases){
  results[counter] <- mean(i$choose_B)
  counter <- counter + 1
}

pre_mean <- results[1]
post_mean <- mean(results[2], results[3])
diff <- abs(pre_mean - post_mean)

cat("Difference in Pre vs Post means:", diff*100, "percentage points")
```

```{r}
library(sandwich)
library(lmtest)
library(zoo)

block2$choose_B <- ifelse(block2$player.buyer_choice == "B", 1, 0)

m <- glm(choose_B ~ subsession.treatment, data=block2, family=binomial())

vc <- vcovCL(m, cluster = ~ participant.code)
coeftest(m, vcov. = vc)
```

```{r}
# Intercept = T0
logit_T0 <- -1.9459
logit_T1 <- -1.9459 + 3.0445
logit_T2 <- -1.9459 + 3.2809

# Convert to probabilities
prob_T0 <- plogis(logit_T0)  # ≈ 0.125
prob_T1 <- plogis(logit_T1)  # ≈ 0.70
prob_T2 <- plogis(logit_T2)  # ≈ 0.74
```
